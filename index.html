<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha DaggerHeart</title>
    <link rel="stylesheet" href="style.css?v=4">
    <link rel="preconnect" href="https://fonts.googleapis.com">
</head>

<body>

    <img alt="Imagem de uma paisagem de fantasia" src="header1.jpg">

    <br><br>

    <!--CABEÇALHO DO PERSONAGEM-->
    <div class="inicio">
        <div>
            <p>NOME:  </p>
            <input type="text" data-save="nomechar">
        </div>

        <div>
            <p>PRONOMES:  </p>
            <input type="text" data-save="pronomechar" style="max-width: 50px;">
        </div>

        <div>
            <p>ORIGEM:  </p>
            <input type="text" data-save="herancachar">
        </div>

        <div>
            <p>SUBCLASSES:  </p>
            <input type="text" data-save="subclassechar" style="width: 340px;">
        </div>

        <div class="nivel">
            <p>NIVEL:  </p>
            <input type="number" data-save="levelchar">
        </div>
    </div>

    <br> <br>

    <!--ATRIBUTOS-->
    <div class="atributos">
        <div>
            <p>EVASÃO  </p>
            <input type="number" min="0" placeholder="0" data-save="evasao">
        </div>

        <div class="armor">
            <div>
                <p>ARMADURA  </p>
                <input type="number" min="0" placeholder="0" data-save="armadura">
            </div>

            <div class="check">
                <input type="checkbox" data-save="armcheck1">
                <input type="checkbox" data-save="armcheck2">
                <input type="checkbox" data-save="armcheck3">
                <input type="checkbox" data-save="armcheck4">
                <input type="checkbox" data-save="armcheck5">
                <input type="checkbox" data-save="armcheck6">
                <input type="checkbox" data-save="armcheck7">
                <input type="checkbox" data-save="armcheck8">
                <input type="checkbox" data-save="armcheck9">
                <input type="checkbox" data-save="armcheck10">
                <input type="checkbox" data-save="armcheck11">
                <input type="checkbox" data-save="armcheck12">
            </div>
        </div>

        

        <div class="atributo">
            <button onclick="rolardados('agilidade')">AGI</button>
            <input type="number" id="agilidade" placeholder="0" data-save="agi">
        </div>

        <div class="atributo">
            <button onclick="rolardados('forca')">FOR</button>
            <input type="number" id="forca" placeholder="0" data-save="for">
        </div>

        <div class="atributo">
            <button onclick="rolardados('destreza')">DEX</button>
            <input type="number" id="destreza" placeholder="0" data-save="fin">
        </div>

        <div class="atributo">
            <button onclick="rolardados('instinto')">INS</button>
            <input type="number" id="instinto" placeholder="0" data-save="ins">
        </div>

        <div class="atributo">
            <button onclick="rolardados('presenca')">PRE</button>
            <input type="number" id="presenca" placeholder="0" data-save="pre">
        </div>

        <div class="atributo">
            <button onclick="rolardados('sabedoria')">SAB</button>
            <input type="number" id="sabedoria" placeholder="0" data-save="con">
        </div>

        <div class="atributo">
            <p>VANTAGEM</p>
            <input type="checkbox" id="vantagem" data-save="vantagem">
        </div>

        <div class="atributo">
            <p>DESVANTAGEM</p>
            <input type="checkbox" id="desvantagem" data-save="desvantagem">
        </div>

    </div>

    <br> <br>

    <!--DIV COM AS DUAS COLUNAS E O RESTO DAS COISAS-->
    <div class="main">

        <!--ESQUERDA-->
        <div class="esqdir">

            

            <div style="border: 2px solid rgba(136, 136, 136, 0.808); border-radius: 10px; padding: 7px;">

                <h2>SAÚDE</h2> <hr>

                <p style="text-align: center;">VIDA MÁXIMA:
                    <input type="number" data-save="vidamax" style="width: 30px; font-size: 20px;">
                    <input type="checkbox" data-save="vidacheck1">
                    <input type="checkbox" data-save="vidacheck2">
                    <input type="checkbox" data-save="vidacheck3">
                    <input type="checkbox" data-save="vidacheck4">
                    <input type="checkbox" data-save="vidacheck5">
                    <input type="checkbox" data-save="vidacheck6">
                    <input type="checkbox" data-save="vidacheck7">
                    <input type="checkbox" data-save="vidacheck8">
                    <input type="checkbox" data-save="vidacheck9">
                    <input type="checkbox" data-save="vidacheck10">
                    <input type="checkbox" data-save="vidacheck11">
                    <input type="checkbox" data-save="vidacheck12">
                </p>
                
            </br>

            <p style="text-align: center;">STRESS MÁXIMO:
                    <input type="number" data-save="stressmax" style="width: 30px; font-size: 20px;">
                    <input type="checkbox" data-save="stresscheck1">
                    <input type="checkbox" data-save="stresscheck2">
                    <input type="checkbox" data-save="stresscheck3">
                    <input type="checkbox" data-save="stresscheck4">
                    <input type="checkbox" data-save="stresscheck5">
                    <input type="checkbox" data-save="stresscheck6">
                    <input type="checkbox" data-save="stresscheck7">
                    <input type="checkbox" data-save="stresscheck8">
                    <input type="checkbox" data-save="stresscheck9">
                    <input type="checkbox" data-save="stresscheck10">
                    <input type="checkbox" data-save="stresscheck11">
                    <input type="checkbox" data-save="stresscheck12">
                </p>
                
            </br>
                
                <div class="dano">
                        
                            <p>MAIOR
                            <input type="number" data-save="danomaior" style="width: 30px; font-size: 20px;"> </p>
                        
                        
                            <p>SEVERO
                            <input type="number" data-save="danosevero" style="width: 30px; font-size: 20px;"> </p>
                        
                </div>
            </div>

            <BR>
                <br>


            <div style="border: 2px solid rgba(136, 136, 136, 0.808); border-radius: 10px; padding: 7px; text-align: center;">
                <h2>ESPERANÇA</h2> <hr>
                <div class="checkesp">

                <input type="checkbox" data-save="esperancacheck1">
                <input type="checkbox" data-save="esperancacheck2">
                <input type="checkbox" data-save="esperancacheck3"> 
                <input type="checkbox" data-save="esperancacheck4">
                <input type="checkbox" data-save="esperancacheck5">
                <input type="checkbox" data-save="esperancacheck6">

                </div>        
            

            <br>
            
            <textarea placeholder="Aspecto de Esperança" data-save="recursoesperanca"
            style="min-height: 100px; min-width: 100%; max-width: fit-content;"></textarea>

            </div>

            <br>
            <br>

            <div style="border: 2px solid rgba(136, 136, 136, 0.808); border-radius: 10px; padding: 7px;">
                <h2>EXPERIÊNCIAS</h2> <hr>
                
                <input type="text" data-save="exp1" style="min-width: 99%;"> <br>
                <input type="text" data-save="exp2" style="min-width: 99%;"> <br>
                <input type="text" data-save="exp3" style="min-width: 99%;"> <br>
                <input type="text" data-save="exp4" style="min-width: 99%;"> <br>
                <input type="text" data-save="exp5" style="min-width: 99%;"> <br>

                
                
            
            </div>

            <br>
            <br>

            <div style="text-align: center; border: 2px solid rgba(136, 136, 136, 0.808); border-radius: 10px; padding: 7px;"">
            <h2>OURO</h2> <hr>
            <p>PUNHADOS
                <input type="checkbox" data-save="punhado1">
                <input type="checkbox" data-save="punhado2">
                <input type="checkbox" data-save="punhado3">
                <input type="checkbox" data-save="punhado4">
                <input type="checkbox" data-save="punhado5">
                <input type="checkbox" data-save="punhado6">
                <input type="checkbox" data-save="punhado7">
                <input type="checkbox" data-save="punhado8">
                <input type="checkbox" data-save="punhado9">
            </p>

            <p>SACOS
                <input type="checkbox" data-save="saco1">
                <input type="checkbox" data-save="saco2">
                <input type="checkbox" data-save="saco3">
                <input type="checkbox" data-save="saco4">
                <input type="checkbox" data-save="saco5">
                <input type="checkbox" data-save="saco6">
                <input type="checkbox" data-save="saco7">
                <input type="checkbox" data-save="saco8">
                <input type="checkbox" data-save="saco9">
            </p>

            <p>BAÚS
                <input type="checkbox" data-save="bau1">
                <input type="checkbox" data-save="bau2">
                <input type="checkbox" data-save="bau3">
                <input type="checkbox" data-save="bau4">
                <input type="checkbox" data-save="bau5">
                <input type="checkbox" data-save="bau6">
                <input type="checkbox" data-save="bau7">
                <input type="checkbox" data-save="bau8">
                <input type="checkbox" data-save="bau9">
            </p>
            </div>

            <br>
            <br>

            <div style="border: 2px solid rgba(136, 136, 136, 0.808); border-radius: 10px; padding: 7px;text-align: center;">
                <h2>ASPECTO DE CLASSE</h2> <hr>
                
                <textarea data-save="recursoclasse" style="min-height: 228px; min-width: 100%; max-width:fit-content;"></textarea>
            </div>

            

        </div>

        

        

        
        
        <!--DIREITA-->
        <div class="esqdir">
            <div style="border: 2px solid rgba(136, 136, 136, 0.808); border-radius: 10px; padding: 7px; text-align: center;">
                <h2>ARMAS ATIVAS</h2>
                <hr>
                <p style="text-align: start;">PROFICIÊNCIA 
                    <input type="checkbox" data-save="proficiencia1">
                    <input type="checkbox" data-save="proficiencia2">
                    <input type="checkbox" data-save="proficiencia3">
                    <input type="checkbox" data-save="proficiencia4">
                    <input type="checkbox" data-save="proficiencia5">
                    <input type="checkbox" data-save="proficiencia6">
                </p>

                
                <br>
                
                <div>
                    <p>PRIMÁRIA</p>
                    <input type="text" data-save="nomearma1" placeholder="Nome" style="max-width: 400px;">
                    <input type="text" data-save="alcancearma1" placeholder="Alcance">
                    <input type="text" id="inputArma1" data-save="dadoarma1" placeholder="Dado e Tipo">
                    <button onclick="rolarArma(1)" id="rolararma1" style="transform: scale(0.8);">ROLAR</button>
                    <br>
                    <br>
                    <textarea data-save="recursoarma1" style="min-width: 99%; max-width: 99%; min-height: 45px;"></textarea>


                </div>

            
            </br>

                <div>
                    <p>SECUNDÁRIA</p>
                    <input type="text" data-save="nomearma2" placeholder="Nome" style="max-width: 400px;">
                    <input type="text" data-save="alcancearma2" placeholder="Alcance">
                    <input type="text" id="inputArma2" data-save="dadoarma2" placeholder="Dado e Tipo">
                    <button onclick="rolarArma(2)" id="rolararma2" style="transform: scale(0.8);">ROLAR</button>
                    <br>
                    <br>
                    <textarea data-save="recursoarma2" style="min-width: 99%; max-width: 99%; min-height: 45px;"></textarea>

                </div>

            </div>

            <br>

            <div style="border: 2px solid rgba(136, 136, 136, 0.808); border-radius: 10px; padding: 7px; text-align: center;">
                <h2>ARMADURA ATIVA</h2> <hr>
                <input type="text" data-save="nomearmadura" placeholder="Nome" style="max-width: 400px;">
                <input type="text" data-save="limitearmadura" placeholder="Limite">
                <input type="text" data-save="pontosarmadura" placeholder="Pontos">
                <br>
                <br>
                <textarea data-save="recursoarmadura" style="min-width: 99%; max-width: 99%; min-height: 45px;"></textarea>


            </div>


            <br>

            <div style="border: 2px solid rgba(136, 136, 136, 0.808);
            border-radius: 10px; padding: 7px; text-align: center;">
                <h2>INVENTÁRIO</h2> <hr>
                
                <textarea data-save="inventario" style="min-width: 99%; max-width: 99%; min-height: 200px;"></textarea>

                <br>
                <br>

                <div style="border: 2px solid rgba(136, 136, 136, 0.808);
            border-radius: 10px; padding: 7px; text-align: center;">
                    <p>ARMA DO INVENTÁRIO</p>
                    <input type="text" data-save="nomearmainv1" placeholder="Nome" style="max-width: 400px;">
                    <input type="text" data-save="alcancearmainv1" placeholder="Alcance">
                    <input type="text" data-save="dadoarmainv1" placeholder="Dado e Tipo">
                    <br>
                    <button style="transform: scale(0.7);" onclick="trocarArma(1, 1)">PRIMÁRIA</button>
                    <button style="transform: scale(0.7);" onclick="trocarArma(1, 2)">SECUNDÁRIA</button>
                    <br>
                    <br>
                    <textarea data-save="recursoarmainv1" style="min-width: 99%; max-width: 99%; min-height: 45px;"></textarea>


                </div>

                <br>

                <div style="border: 2px solid rgba(136, 136, 136, 0.808);
            border-radius: 10px; padding: 7px; text-align: center;">
                    <p>ARMA DO INVENTÁRIO</p>
                    <input type="text" data-save="nomearmainv2" placeholder="Nome" style="max-width: 400px;">
                    <input type="text" data-save="alcancearmainv2" placeholder="Alcance">
                    <input type="text" data-save="dadoarmainv2" placeholder="Dado e Tipo">
                    <br>
                    <button style="transform: scale(0.7);" onclick="trocarArma(2, 1)">PRIMÁRIA</button>
                    <button style="transform: scale(0.7);" onclick="trocarArma(2, 2)">SECUNDÁRIA</button>
                    <br>
                    <br>
                    <textarea data-save="recursoarmainv2" style="min-width: 99%; max-width: 99%; min-height: 45px;"></textarea>

                </div>


            </div>

        </div>

        <div>
            
        </div>
    </div>


        <h2>CARTAS 
            <input type="number" id="quantidade" data-save="cartas" min="0" max="30" value="0" placeholder="0"
                style="height: 25px; font-size: 20px;">
        </h2>
        

        <div id="containerDivs"></div>








        <BR>
        <div style="display:flex; justify-content: center; gap:10px">

            <button id="exportar">EXPORTAR</button>
            <button id="importar">IMPORTAR</button>
            <input type="file" id="fileInput" accept=".json" hidden>

        </div>


        <div id="popupOverlay" class="popup-overlay">
            <div class="popup">
                <h2 id="popupTitulo"></h2>
                <p id="popupTexto"></p>

                <button onclick="fecharPopup()">Fechar</button>
            </div>
        </div>






<script>

// FUNÇÕES DE ROLAGEM DE DADOS
  
function rolarD4()   { return Math.floor(Math.random() * 4) + 1; }
function rolarD6()   { return Math.floor(Math.random() * 6) + 1; }
function rolarD8()   { return Math.floor(Math.random() * 8) + 1; }
function rolarD10()  { return Math.floor(Math.random() * 10) + 1; }
function rolarD12()  { return Math.floor(Math.random() * 12) + 1; }

// Rola dados de atributos com vantagem/desvantagem e bônus
function rolardados(atr) {
    const bonus = parseInt(document.getElementById(atr).value) || 0;
    const vant = document.getElementById("vantagem");
    const desvant = document.getElementById("desvantagem");

    let dadomenos = desvant.checked ? rolarD6() : 0;
    let dadoextra = vant.checked ? rolarD6() : 0;

    const hope = rolarD12();
    const fear = rolarD12();
    const result = hope + fear + bonus + dadoextra - dadomenos;

    const titulo = atr.toUpperCase() + "<br><br>";
    let mensagem = `${result} | `;

    if (hope === fear) mensagem += "CRÍTICO!<br><br>";
    else if (hope > fear) mensagem += "ESPERANÇA<br><br>";
    else mensagem += "MEDO<br><br>";

    mensagem += `Hope: ${hope} | Fear: ${fear}`;
    if (dadoextra) mensagem += ` | Vantagem: ${dadoextra}`;
    else if (dadomenos) mensagem += ` | Desvantagem: ${dadomenos}`;

    abrirPopup(titulo, mensagem);
}

// Rola qualquer dado com formato NdX+Y
function rolarDadosString(texto) {
    const regex = /^(\d+)d(\d+)(\+(\d+))?$/i;
    const match = texto.match(regex);
    if (!match) {
        alert("Formato inválido! Use XdY+Z (ex: 3d6+2)");
        return null;
    }

    const quantidade = parseInt(match[1]);
    const faces = parseInt(match[2]);
    const bonus = match[4] ? parseInt(match[4]) : 0;

    let total = 0, resultados = [];

    for (let i = 0; i < quantidade; i++) {
        let dado;
        switch(faces) {
            case 4: dado = rolarD4(); break;
            case 6: dado = rolarD6(); break;
            case 8: dado = rolarD8(); break;
            case 10: dado = rolarD10(); break;
            case 12: dado = rolarD12(); break;
            default:
                alert("Número de faces inválido! Use 4,6,8,10 ou 12.");
                return null;
        }
        resultados.push(dado);
        total += dado;
    }

    total += bonus;
    return { total, resultados, bonus };
}

// Rola dano da arma
function rolarArma(numArma) {
    const inputId = numArma === 1 ? "inputArma1" : "inputArma2";
    const texto = document.getElementById(inputId).value;

    const resultado = rolarDadosString(texto);
    if (!resultado) return;

    const titulo = `Arma ${numArma}<br>`;
    let mensagem = `Dados: ${resultado.resultados.join(", ")}<br>`;
    if (resultado.bonus) mensagem += `Bonus: ${resultado.bonus}<br>`;
    mensagem += `<br>Total: ${resultado.total}`;

    abrirPopup(titulo, mensagem);
}



//  Troca Arma do inventário com Arma da mão


function trocarArma(invNum, maoNum) {
    const campos = ["nome", "alcance", "dado", "recurso"];

    campos.forEach(campo => {
        const inv = document.querySelector(`[data-save="${campo}armainv${invNum}"]`);
        const mao = document.querySelector(`[data-save="${campo}arma${maoNum}"]`);

        if (!inv || !mao) return;

        const temp = inv.value;
        inv.value = mao.value;
        mao.value = temp;
    });
}




//   POPUP

function abrirPopup(titulo, texto) {
    document.getElementById("popupTitulo").innerHTML = titulo;
    document.getElementById("popupTexto").innerHTML = texto;
    document.getElementById("popupOverlay").classList.add("ativo");
}

function fecharPopup() {
    document.getElementById("popupOverlay").classList.remove("ativo");
}


// Coleta e aplica os dados do usuário

function coletarDados() {
    const dados = {};
    document.querySelectorAll("[data-save]").forEach(el => {
        const chave = el.dataset.save;
        if (el.type === "checkbox") dados[chave] = el.checked;
        else if (el.type === "number") dados[chave] = Number(el.value);
        else dados[chave] = el.value;
    });
    return dados;
}

function aplicarDados(dados) {
    document.querySelectorAll("[data-save]").forEach(el => {
        const chave = el.dataset.save;
        if (!(chave in dados)) return;
        if (el.type === "checkbox") el.checked = dados[chave];
        else el.value = dados[chave];
    });

    atualizarDivsVisiveis(); 
}


// Exporta e Importa os dados do usuário como arquivo

document.getElementById("exportar").addEventListener("click", () => {
    const dados = coletarDados();
    const blob = new Blob([JSON.stringify(dados, null, 2)], { type: "application/json" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "ficha.json";
    a.click();
});

document.getElementById("importar").addEventListener("click", () => {
    document.getElementById("fileInput").click();
});

document.getElementById("fileInput").addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
        const dados = JSON.parse(reader.result);
        aplicarDados(dados);
    };
    reader.readAsText(file);
});


// Cria divs de cartas dinamicamente

const container = document.getElementById("containerDivs");
const totalDivs = 30;


for (let i = 1; i <= totalDivs; i++) {
    const div = document.createElement("div");
    div.classList.add("div-item");

    // DOMÍNIO + GASTO
    const linhaElemento = document.createElement("div");
    linhaElemento.classList.add("linha-elemento");

    const elementoInput = document.createElement("input");
    elementoInput.type = "text";
    elementoInput.placeholder = "DOMINIO";
    elementoInput.setAttribute("data-save", `elemento-${i}`);

    const energiaInput = document.createElement("input");
    energiaInput.type = "number";
    energiaInput.placeholder = "GASTO";
    energiaInput.setAttribute("data-save", `energia-${i}`);

    linhaElemento.appendChild(elementoInput);
    linhaElemento.appendChild(energiaInput);
    div.appendChild(linhaElemento);

    // TIPO
    const tipoInput = document.createElement("input");
    tipoInput.type = "text";
    tipoInput.placeholder = "TIPO";
    tipoInput.setAttribute("data-save", `tipo-${i}`);
    div.appendChild(tipoInput);

    // NOME
    const nomeInput = document.createElement("input");
    nomeInput.type = "text";
    nomeInput.placeholder = "NOME";
    nomeInput.setAttribute("data-save", `nome-${i}`);
    div.appendChild(nomeInput);

    // DESCRIÇÃO
    const descTextarea = document.createElement("textarea");
    descTextarea.placeholder = "DESCRIÇÃO";
    descTextarea.setAttribute("data-save", `descricao-${i}`);
    div.appendChild(descTextarea);

    container.appendChild(div);
}

// Mostra as cartas quando muda a quantidade
document.getElementById("quantidade").addEventListener("input", atualizarDivsVisiveis);

function atualizarDivsVisiveis() {
    const input = document.getElementById("quantidade");
    const valor = parseInt(input.value) || 0;
    const divs = container.children;

    for (let i = 0; i < totalDivs; i++) {
        divs[i].style.display = i < valor ? "block" : "none";
    }
}

</script>
</body>
</html>